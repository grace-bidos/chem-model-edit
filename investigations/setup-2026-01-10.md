# セットアップ記録 (2026-01-10)

## 目的
- 新規デバイスで `chem-model-edit` を動かすための環境構築。
- QE 計算の実行環境は不要（後で切り出す前提）。

## 事前確認
- `node -v` -> v22.16.0
- `corepack --version` -> 0.32.0
- `pnpm -v` -> 10.27.0
- `python3 --version` -> 3.12.3 (要件は >=3.13)
- `uv --version` -> 0.6.14
- `just --version` -> 未インストール

## 実施内容
### 1) pnpm セットアップ
```bash
corepack enable
corepack prepare pnpm@10.27.0 --activate
pnpm install
```
結果:
- `pnpm install` は成功。
- 警告: `@parcel/watcher` の build scripts がデフォルトで無効化されている旨。
  - 監視機能が必要な場合は `pnpm approve-builds` を検討。

### 2) Python 3.13 の用意 (uv)
```bash
uv python install 3.13
```
結果:
- CPython 3.13.3 を uv 管理下にインストール。

### 3) API 依存関係の同期
```bash
cd apps/api
uv sync
```
結果:
- `.venv` を作成し、依存関係のインストールに成功。
- Python は `3.13.3` が使用された。

### 4) `just` の導入
試行:
```bash
sudo apt-get update
```
結果:
- パスワード入力待ちでタイムアウトしたため中断。

代替:
```bash
cargo install just
just --version
```
結果:
- `just 1.46.0` を導入（`~/.cargo/bin/just`）。

### 5) `pnpm approve-builds` 実行
```bash
pnpm approve-builds
```
結果:
- `@parcel/watcher` を承認し、install script が実行された。
- `pnpm-workspace.yaml` に `onlyBuiltDependencies` として `@parcel/watcher` が追加された。

### 6) dev サーバ起動確認（タイムアウトで停止）
```bash
timeout 10s pnpm -C apps/web dev
timeout 10s uv run uvicorn main:app --reload --port 8000
timeout 10s just dev
```
結果:
- Web: Vite が `http://localhost:3000/` で起動することを確認（10 秒で停止）。
- API: Uvicorn が `http://127.0.0.1:8000` で起動することを確認（10 秒で停止）。
- `just dev` でも Web/API が起動することを確認（Web は `http://localhost:3001/`、10 秒で停止）。

### 7) 品質チェック
Web:
```bash
pnpm -C apps/web typecheck
pnpm -C apps/web lint
pnpm -C apps/web test
```
結果:
- すべて成功（Vitest: 4 files / 7 tests）。

API:
```bash
cd apps/api
uv run pytest
uv run mypy .
```
結果:
- pytest: 16 tests passed
- mypy: no issues
## 残タスク / 相談ポイント
- 追加の検証や Docker 化などは後続タスクに回す。

## QE 計算環境について
- QE 実行に必要な依存は導入していない（要件どおり）。

## 整備したドキュメント / スクリプト
- `docs/setup.md` / `docs/setup.ja.md` を追加（セットアップ手順を整理）。
- `scripts/setup-dev.sh` を追加（初期セットアップの自動化）。
- `Justfile` に `setup` タスクを追加（`scripts/setup-dev.sh` を実行）。
